<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>{{ if .IsHome }}{{ .Site.Title }}{{ else }}{{ .Title }} | {{ .Site.Title }}{{ end }}</title>

  {{ $style := resources.Get "css/main.css" | minify | fingerprint }}
  <link rel="stylesheet" href="{{ $style.RelPermalink }}">

  <link rel="stylesheet" href="https://rsms.me/inter/inter.css">
</head>
<body>
  <div class="shell">
    <header class="sidebar">
      <div class="site-name">
        <a href="#about">
          <span class="next">Next</span><span class="work">Work</span><span class="lab">Lab.</span>
        </a>
      </div>
      <p class="site-tagline">신체 부담은 줄이고, 더 안전하게 일할 수 있도록</p>

      <nav class="side-nav">
        <a href="#about">소개</a>
        <a href="#function">신체기능</a>
        <a href="#safework">안전한 작업</a>
        <a href="#contact">문의</a>
      </nav>
    </header>

    <main class="main">
      <div class="main-inner">
        {{ block "main" . }}{{ end }}
      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        <p class="copyright">&copy; {{ now.Format "2006" }} NextWork Lab. All rights reserved.</p>
      </div>
    </footer>
  </div>

  <!-- Catalog Gate Modal: 반드시 panel(.panel) 밖에 있어야 동작 -->
  <div id="catalogGate" class="catalogGate" aria-hidden="true" style="display:none; position:fixed; inset:0; background:rgba(0,0,0,0.6); z-index:9999;">
    <div class="catalogGate__dialog" role="dialog" aria-modal="true" aria-labelledby="catalogGateTitle"
         style="width:100%; max-width:560px; margin:9vh auto; background:#fff; border-radius:12px; padding:22px;">
      <div class="catalogGate__header" style="display:flex; align-items:center; justify-content:space-between; gap:12px;">
        <h3 id="catalogGateTitle" class="catalogGate__title" style="margin:0;">카탈로그 열기</h3>
        <button type="button" class="catalogGate__close" data-gate-close aria-label="닫기"
                style="border:0; background:transparent; cursor:pointer; font-size:18px; line-height:1; padding:6px;">✕</button>
      </div>

      <p class="catalogGate__desc" style="font-size:14px; color:var(--muted); margin:10px 0 16px;">자료 제공을 위해 간단한 정보만 확인합니다.</p>

      <div class="catalogGate__form" style="display:grid; gap:12px;">
        <input id="cgName" class="catalogGate__input" placeholder="예: 홍길동" autocomplete="name" inputmode="text" style="width:100%; height:54px; padding:0 14px;">
        <input id="cgOrg" class="catalogGate__input" placeholder="예: 동원식품" autocomplete="organization" inputmode="text" style="width:100%; height:54px; padding:0 14px;">

        <div class="catalogGate__phone" style="display:grid; grid-template-columns: 1.2fr 1fr 1fr; gap:10px;">
          <input id="cgPhone1" class="catalogGate__input" placeholder="010/02/+82" autocomplete="tel" inputmode="tel" style="width:100%; height:54px; padding:0 14px;">
          <input id="cgPhone2" class="catalogGate__input" placeholder="5643" inputmode="numeric" style="width:100%; height:54px; padding:0 14px;">
          <input id="cgPhone3" class="catalogGate__input" placeholder="5471" inputmode="numeric" style="width:100%; height:54px; padding:0 14px;">
        </div>
      </div>

      <div class="catalogGate__actions" style="display:flex; gap:12px; margin-top:16px;">
        <button type="button" class="btn-nextwork" data-gate-close style="flex:1; height:54px;">취소</button>
        <button type="button" class="btn-nextwork btn-download" id="catalogGateSubmit" style="flex:1; height:54px;">확인 후 열기</button>
      </div>

      <p class="catalogGate__note" style="font-size:12px; color:var(--muted); margin:14px 0 0;">자료 제공 목적 외의 연락은 드리지 않습니다.</p>
    </div>
  </div>

  <!-- CORS 회피용: form + hidden iframe (저장 성공/실패 판정 없이 백그라운드 전송) -->
  <iframe name="catalogGateSink" title="catalog gate sink" style="display:none;"></iframe>
  <form id="catalogGateForm" method="POST" target="catalogGateSink" style="display:none;">
    <input name="name" />
    <input name="org" />
    <input name="phone" />
    <input name="pdf" />
    <input name="referrer" />
    <input name="userAgent" />
  </form>

  <script>
    (function() {
      function showPanel() {
        const hash = window.location.hash || "#about";
        const target = document.querySelector(hash);
        if (!target) return;

        document.querySelectorAll(".panel").forEach(p => p.classList.remove("is-default"));
        target.classList.add("is-default");

        document.querySelectorAll(".side-nav a").forEach(a => {
          a.classList.toggle("is-active", a.getAttribute("href") === hash);
        });

        window.scrollTo({ top: 0, behavior: "smooth" });
      }
      window.addEventListener("hashchange", showPanel);
      document.addEventListener("DOMContentLoaded", showPanel);
    })();
  </script>

  <script>
    (function () {
      const WEB_APP_URL = "https://script.google.com/macros/s/AKfycbwAodR5cJlgIo2ZlfOokDiX3AyeQmk2Sh36ZBN1AZCNAIkGw8eQwCKuRLgb0u7tGsbC/exec";

      let targetPdf = null;
      let lastTrigger = null;

      function openGate(pdfUrl, triggerEl) {
        const gateEl = document.getElementById("catalogGate");
        if (!gateEl || !pdfUrl) return;

        targetPdf = pdfUrl;
        lastTrigger = triggerEl || null;

        gateEl.style.display = "block";
        gateEl.setAttribute("aria-hidden", "false");

        const nameEl = document.getElementById("cgName");
        const orgEl = document.getElementById("cgOrg");
        const phone1El = document.getElementById("cgPhone1");
        const phone2El = document.getElementById("cgPhone2");
        const phone3El = document.getElementById("cgPhone3");
        if (nameEl) nameEl.value = "";
        if (orgEl) orgEl.value = "";
        if (phone1El) phone1El.value = "";
        if (phone2El) phone2El.value = "";
        if (phone3El) phone3El.value = "";

        setTimeout(function () {
          if (nameEl) nameEl.focus();
        }, 0);
      }

      function closeGate() {
        const gateEl = document.getElementById("catalogGate");
        if (!gateEl) return;

        gateEl.style.display = "none";
        gateEl.setAttribute("aria-hidden", "true");
        targetPdf = null;

        if (lastTrigger && typeof lastTrigger.focus === "function") {
          lastTrigger.focus();
        }
        lastTrigger = null;
      }

      function submitGate() {
        const nameEl = document.getElementById("cgName");
        const orgEl = document.getElementById("cgOrg");
        const p1El = document.getElementById("cgPhone1");
        const p2El = document.getElementById("cgPhone2");
        const p3El = document.getElementById("cgPhone3");

        const name = nameEl ? nameEl.value.trim() : "";
        const org = orgEl ? orgEl.value.trim() : "";
        const p1 = p1El ? p1El.value.trim() : "";
        const p2 = p2El ? p2El.value.trim() : "";
        const p3 = p3El ? p3El.value.trim() : "";

        // 입력 검증은 최소화: 값의 '진위' 검증은 하지 않고, 비어있지만 않도록만 처리
        if (!name || !org || (!p1 && !p2 && !p3)) {
          alert("이름, 소속, 연락처를 입력해 주세요.");
          return;
        }

        // 전화번호는 3칸을 합쳐 저장 (지역번호/해외 번호 포함 허용)
        let phone = [p1, p2, p3].filter(Boolean).join("-");
        phone = phone.replace(/[^0-9+\-]/g, "");

        // CORS 이슈 회피: hidden form + iframe 으로 백그라운드 전송
        const form = document.getElementById("catalogGateForm");
        if (form) {
          form.action = WEB_APP_URL;
          form.querySelector('input[name="name"]').value = name;
          form.querySelector('input[name="org"]').value = org;
          form.querySelector('input[name="phone"]').value = phone;
          form.querySelector('input[name="pdf"]').value = targetPdf || "";
          form.querySelector('input[name="referrer"]').value = document.referrer || "";
          form.querySelector('input[name="userAgent"]').value = navigator.userAgent || "";
          try { form.submit(); } catch (e) {}
        }

        const pdf = targetPdf;
        closeGate();
        if (pdf) window.open(pdf, "_blank", "noopener");
      }

      document.addEventListener("click", function (e) {
        const a = e.target && e.target.closest ? e.target.closest("a.js-catalog") : null;
        if (a) {
          e.preventDefault();
          const pdf = a.getAttribute("data-pdf") || a.getAttribute("href");
          openGate(pdf, a);
          return;
        }

        const closeBtn = e.target && e.target.closest ? e.target.closest("[data-gate-close]") : null;
        if (closeBtn) {
          e.preventDefault();
          closeGate();
          return;
        }

        const gateEl = document.getElementById("catalogGate");
        if (gateEl && gateEl.style.display !== "none" && e.target === gateEl) {
          closeGate();
        }
      });

      document.addEventListener("keydown", function (e) {
        const gateEl = document.getElementById("catalogGate");
        if (!gateEl || gateEl.style.display === "none") return;

        if (e.key === "Escape") {
          closeGate();
          return;
        }

        if (e.key === "Enter") {
          const active = document.activeElement;
          const nameEl = document.getElementById("cgName");
          const orgEl = document.getElementById("cgOrg");
          const p1El = document.getElementById("cgPhone1");
          const p2El = document.getElementById("cgPhone2");
          const p3El = document.getElementById("cgPhone3");
          if (active === nameEl || active === orgEl || active === p1El || active === p2El || active === p3El) {
            e.preventDefault();
            submitGate();
          }
        }
      });

      document.addEventListener("DOMContentLoaded", function () {
        const submitEl = document.getElementById("catalogGateSubmit");
        if (submitEl) {
          submitEl.addEventListener("click", function () {
            submitGate();
          });
        }

        const phone = "010-5643-5471";
        const contactPhoneEl = document.getElementById("contact-phone");
        if (contactPhoneEl) {
          contactPhoneEl.textContent = phone;
          contactPhoneEl.href = "tel:" + phone.replace(/-/g, "");
        }

        const user = "info";
        const domain = "tuatua.kr";
        const contactEmailEl = document.getElementById("contact-email");
        if (contactEmailEl) {
          const email = user + "@" + domain;
          contactEmailEl.textContent = email;
          contactEmailEl.href = "mailto:" + email;
        }
      });
    })();
  </script>
</body>
</html>
